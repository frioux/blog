#!/usr/bin/perl

use strict;
use warnings;

no warnings 'uninitialized';

use JSON::PP;
use POSIX 'strftime';

my $last_week = strftime("%F", localtime time - 7*24*60*60);

my @json = `q --format 'require JSON::PP; JSON::PP::encode_json(\\%r)' --sql 'SELECT title, filename FROM articles WHERE date > ?' $last_week`;

my @data = map { decode_json($_) } @json;

my $i = 0;
for my $d (@data) {
   $i++;

   my $url = $d->{filename};
   $url =~ s(^content)(https://blog.afoolishmanifesto.com);
   $url =~ s(\.md$)(/);
   print " * $d->{title} [$url]\n";
}

# load subs of email per line in dropbox
# send
